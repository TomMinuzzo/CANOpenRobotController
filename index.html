<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CORC Project: CANOpen Robot Controller (CORC) Project</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CORC Project
   </div>
   <div id="projectbrief">CANOpen Robot Controller Software Documentation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Packages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">CANOpen <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> Controller (CORC) Project </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>CORC is a free and open source robotic development software stack, written in C++.</p>
<p>The project has been under development at the University of Melbourne in partnership with Fourier Intelligence. The project was developed to run on an X2 Exoskeleton powered by a Beaglebone Black, however, the software is designed to be extensible to any embedded Linux and CANopen enabled Robotic platform.</p>
<blockquote class="doxtable">
<p>Note (12/5/2020): At this stage, this software has not been tested on physical hardware due to lab access limitations due to COVID-19. </p>
</blockquote>
<h2>The CANOpen <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> Controller project includes:</h2>
<ul>
<li>An extensible framework to represent multibody robotic systems.</li>
<li>An event driven state machine to develop custom applications (see <a class="el" href="md_doc_StateMachine.html">here</a>)</li>
<li>An implementation of <a href="https://github.com/CANopenNode/CANopenSocket">CANopen Socket</a> to provide an interface between CAN enabled embedded Linux system and CANopen-based motor drivers/sensors.</li>
<li><a href="https://unimelb-human-robotics-lab.github.io//CANOpenRobotController/index.html">Documentation</a></li>
<li>Functional application examples.</li>
</ul>
<h3>Project Overview</h3>
<p>The code is structured into 3 levels:</p>
<ol type="1">
<li><b>CANopen Communications Level:</b> Provides the CAN-level communications, providing the mechanisms for the sending and receiving of PDO and SDO messages</li>
<li><b>The <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> Level:</b> Defines the components of the <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> to be controlled, including the joints, associated drives, and input devices</li>
<li><b>The Application Layer:</b> Defines the high level logic for the device, based on the implementation of a <a class="el" href="classState.html" title="Abstract class representing a state in a StateMachine. ">State</a> Machine.</li>
</ol>
<p>Whilst the code can be modified at any level, this structure is designed to provide a degree of modularity. The CANopen Communications level should not need to be changed. The <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> level should only change with respect if the robot to be controlled changes. This is loosely enforced by the source code folder structure - the files which should not need modification are placed in the <code>src/core</code> folder, and the remainder are placed in the <code>src/apps</code> and <code>src/hardware</code> folders. Note that in addition to the CANopen Communication code, the <code>src/core</code> folder also includes base classes which are derived from in the <code>src/apps</code> and <code>src/hardware</code> folders.</p>
<h2>Getting started with CORC</h2>
<p>The following instructions detail the building and testing of a simple test state machine for the X2 Exoskeleton (<a class="el" href="ExoTestMachine_8cpp.html">ExoTestMachine.cpp</a>). This state machine simulates a simple exoskeleton which can move between sitting and standing postures, running in position control, triggered by keyboard events.</p>
<p>At the end of these instructions, you should be to compile and run this example CORC application, verifying that all development tools have been installed correctly.</p>
<h3>Before you start - Installation Instructions.</h3>
<p>These instructions assume that you have a suitable test platform (i.e. a Target), and a workbench environment (i.e. a Host). It is suggested that the Target and Host you use for his guide are the platforms you intend to develop on for your own application.</p>
<h4>Host Installation</h4>
<p>The host is your development computer &mdash; generally running a desktop operating system. Instructions for Windows and Linux systems can be found here:</p>
<ul>
<li><a class="el" href="md_doc_InstallWindows.html">Windows Workbench Setup</a></li>
<li><a class="el" href="md_doc_InstallLinux.html">Linux Workbench Setup</a></li>
</ul>
<p>A previously-used (but not currently recommended) option is to use Docker on a Windows or OSX machine. Some notes on the setup are <a class="el" href="md_doc_Docker.html">here</a>. A final option would be to use a Virtual Machine as your development enviroment. Instructions can be found in Option B <a href="https://exoembedded.readthedocs.io/en/latest/workbench/">here</a>, but this is not currently maintained.</p>
<h4>Target Setup</h4>
<p>The target chosen will ultimately depend on the specific hardware that you are using. CORC was primarily developed to be run on a Beaglebone Black, thus these instructions primarily focus on a BeagleBone Black running Debian Stretch 9.5 <a href="http://beagleboard.org/latest-images">Firmware</a>. Instructions for setting up the Beaglbone Black can be found on <a href="http://beagleboard.org/getting-started">here</a> on the Beaglebone Website.</p>
<blockquote class="doxtable">
<p>Note: if you use a Beagle Bone AI see instructions <a class="el" href="md_doc_BBAISetup.html">here</a> to setup the CAN device. </p>
</blockquote>
<p>If you are running a Linux-based machine, and wish to execute your CORC application on that machine, no additional setup is necessary (instructions specific to this setup are tagged with <b>[DEPLOY-LOCAL]</b> - generally this will mean that you do not have to complete some steps.).</p>
<h3>How to get the Project</h3>
<p>On the host, clone the project from git repository: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ git clone https://github.com/UniMelb-Human-Robotics-Lab/CANOpenRobotController</div></div><!-- fragment --><p>This repository includes all the sources files required for this example. (If you are running Github Desktop, you can simply clone by using File &gt; Clone Repository...)</p>
<h3>Building <a class="el" href="classExoTestMachine.html" title="Example implementation of a StateMachine for the ExoRobot class. States should implemented ExoTestSta...">ExoTestMachine</a></h3>
<p>CMake is used to generate an appropriate makefile for CORC framework. By default, the generated makefile is configured to compile an executable <code>ExoTestMachine_APP</code> using the default C/C++ compilers. To generate a cross-compiled executable (suitable for running on a Beaglebone Black) using the following commands on the host: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ mkdir build</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$ cd build</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;$ cmake -DCMAKE_TOOLCHAIN_FILE=../armhf.cmake ..</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;$ make</div></div><!-- fragment --><p> <b>[WINDOWS]</b> If running on Windows, you will also need to add the <code>-G "Unix Makefiles"</code> flag to the <code>cmake</code> command (i.e. <code>cmake -G "Unix Makefiles" -DCMAKE_TOOLCHAIN_FILE=../armhf.cmake ..</code>). This forces the Unix Makefile format, rather than the default <code>nmake</code> behaviour on Windows.</p>
<p><b>[DEPLOY-LOCAL]</b> If you are intending to execute the application on your (Linux) development computer, you can remove the <code>-DCMAKE_TOOLCHAIN_FILE=../armhf.cmake</code> alltogether (i.e. just run <code>cmake ..</code>). This will use the default C++ compilers on your Linux distribution.</p>
<p>You can alternatively shorten everything to a single line: </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ mkdir build &amp;&amp; cd build/ &amp;&amp; cmake -DCMAKE_TOOLCHAIN_FILE=../armhf.cmake ..</div></div><!-- fragment --> <blockquote class="doxtable">
<p>Note that this requires an appropriately configured toolchain (<code>arm-linux-gnueabihf-</code> toolchain). See "Before you start" to setup an appropriate workbench if required. </p>
</blockquote>
<blockquote class="doxtable">
<p>Note there are also some additional build rules to build additional tests, which are still to be completed (these do not impact the compilation of ExoTestMachine_APP) </p>
</blockquote>
<h3>Transferring files to the Linux platform</h3>
<p>The recommended method of transferring files to the BeagleBone is FTP.</p>
<p>Using an FTP Client on the Host (if you do not have one - or a preferred client, <a href="https://filezilla-project.org/">FileZilla</a> is reasonable), connect to the target (the BeagleBone). By default, when the BeagleBone is connected to a computer using USB, it is configured to:</p>
<ul>
<li><b>IP Address:</b> 192.168.7.2 (Windows) or 192.168.6.2 (OSX and Linux)</li>
<li><b>Username:</b> debian</li>
<li><b>Password:</b> temppwd</li>
</ul>
<p>On the host, using the FTP client, transfer the build executable in <code>build/ExoTestMachine_APP</code>, along with the contents of the <code>initRobot</code> folder, to the Beaglebone.</p>
<p>Alternatively, you can use the <a href="script/uploadBB.sh">script/uploadBB.sh</a> to automatically upload the content of the script folder and the build/*APP to the BeagleBone if you are developing on a Linux Machine.</p>
<blockquote class="doxtable">
<p>Note: The <code>initRobot</code> folder contains scripts for setting up the CAN interfaces that CORC uses for communication </p>
</blockquote>
<p><b>[DEPLOY-LOCAL]</b> This entire step is not required if you are running on your development machine - just note the location of your <code>ExoTestMachine_APP</code> and <code>initRobot</code> folder.</p>
<h2>Run Virtual <a class="el" href="classExoTestMachine.html" title="Example implementation of a StateMachine for the ExoRobot class. States should implemented ExoTestSta...">ExoTestMachine</a></h2>
<h3>Connect to the Target and Modify Run Permissions</h3>
<p>To run the <a class="el" href="classExoTestMachine.html" title="Example implementation of a StateMachine for the ExoRobot class. States should implemented ExoTestSta...">ExoTestMachine</a>, open your preferred terminal window and SSH into the the BeagleBone. This will provide terminal access to the target, on the host. This can be done using the same username and password, e.g:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ssh debian@192.168.7.2</div></div><!-- fragment --><p>At this point, you will need to change the permissions of the executables to allow execution. You can do this using the the <code>chmod +x</code> command on the target. e.g.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ chmod +x ExoTestMachine_APP</div></div><!-- fragment --><p>This must be repeated for the <code>.sh</code> scripts as well.</p>
<p><b>[DEPLOY-LOCAL]</b> If you are deploying to a local machine, these steps are not required are not required, you will just need to open a terminal window for the next steps.</p>
<h3>Initialise Virtual CAN Device</h3>
<p>The CORC Application requires the a CAN device to send commands to. For this test, we create a virtual CAN device (so no hardware is required). To do this, initialise the Virtual CAN device to set up, bind to and run candump (<a href="https://manpages.debian.org/testing/can-utils/candump.1.en.html">candump manpage</a>) on the VCAN interface using the <code>initVCAN</code> script.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$  cd initRobot</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$  ./initVCAN.sh</div></div><!-- fragment --><p> This initialises a virtual CAN interface, and prints the contents of the bus to the terminal window.</p>
<blockquote class="doxtable">
<p>Note: This can be changed to use a non-virtual CAN interface, but this requires some minor changes to the code before compilation, and the use of the <code>X2_startCAN.sh</code> script instead. </p>
</blockquote>
<p>SSH into the BeagleBone in a second terminal window (<b>[DEPLOY-LOCAL]</b> or launch a second terminal) to launch the application:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$  cd build</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;$  sudo ./ExoTestMachine_APP</div></div><!-- fragment --><blockquote class="doxtable">
<p>Note: Superuser privileges (<code>sudo</code>) are required due to the use of real time threads in the application. </p>
</blockquote>
<p>The first terminal one should display CAN messages on VCAN from the <code>EXOTestMachine_APP</code> application output. On startup init PDO messaging should be sent and appear as follows: ​</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vcan0 704 [1] 00</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;vcan0 184 [2] 00 00 # PDO message</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vcan0 704 [1] 05</div></div><!-- fragment --><p>​ Follow terminal instructions using your keyboard in the second terminal instance to run through test stateMachine.​</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;==================================</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; WELCOME TO THE TEST STATE MACHINE</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;==================================</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;==================================</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; PRESS S to start program</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;==================================</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;​</div></div><!-- fragment --><p>The first terminal instance (running candump) should display PDO messages corresponding to changes to the commanded motor positions as follows:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;vcan0  301   [8]  2F 60 60 00 00 00 00 00</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;vcan0  302   [8]  80 60 60 00 00 00 00 00</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;vcan0  303   [8]  2F 60 60 00 00 00 00 00</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;vcan0  304   [8]  80 60 60 00 00 00 00 00</div></div><!-- fragment --><blockquote class="doxtable">
<p>Note these TPDO messages are configured in the Object Dictionary, with configuration SDOs to be sent during the <a class="el" href="classRobot.html" title="Abstract Class representing a robot. Includes vectors of Joint and InputDevice. ">Robot</a> Initialisation stage. Details for the default set of PDOs can be found in the drive.h source files. </p>
</blockquote>
<p>As the simulated device is in position control, these messages should print whenever the system moves from sit to stand or stand to sit, with no messages transmitted whilst the device is stationary (except for the SYNC messages of the format <code>vcan0 080 [0]</code>). CORC has provisions for velocity and torque control, but these are not included in this example for ease of simulation.</p>
<p>If these messages are present, this indicates that the workbench and CORC toolbox have been installed successfully. You can close the program by pressing <code>ctrl+c</code>.</p>
<p>​</p>
<h2>Next Steps</h2>
<h3>Building a custom application with a custom state machine</h3>
<p>To create a custom application with custom state machine, two things must be done.</p>
<p>First, the source code itself must be developed, by deriving the <a class="el" href="classStateMachine.html" title="Abstract class representing a state machine. Includes a number of State and Transition objects...">StateMachine</a> class can be to a custom one (see <a class="el" href="md_doc_StateMachine.html">here for details</a>), named <code>MyCustomStateMachine</code>, in files named <code>MyCustomStateMachine.h/cpp</code>. These must be placed in a dedicated subfolder in the apps folder with a consistent name (e.g. <code>MyCustomStateMachine</code> must be used for both the folder and the file names)</p>
<p>Secondly, CMakeLists.txt must be edited and the entry <code>set (STATE_MACHINE_NAME "ExoTestMachine")</code> changed to <code>set (STATE_MACHINE_NAME "MyCustomStateMachine")</code>.</p>
<p>That's it, simply use the same build procedure.</p>
<h2>Developer Information</h2>
<ul>
<li>Detailed documentation: <a href="https://exoembedded.readthedocs.io/en/latest/">https://exoembedded.readthedocs.io/en/latest/</a></li>
<li>Source code documentation: <a href="https://capstonealex.github.io/exo/index.html">https://capstonealex.github.io/exo/index.html</a></li>
<li>Project Repository: <a href="https://github.com/capstonealex/exo">https://github.com/capstonealex/exo</a></li>
<li>CANopen Socket: <a href="https://github.com/CANopenNode/CANopenSocket">https://github.com/CANopenNode/CANopenSocket</a></li>
</ul>
<p>Feel free to contact fong.j[at]unimelb.edu.au with questions or suggestions for continuing development.</p>
<h2>License</h2>
<p>​ Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at ​ <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a> Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. ​ This program is distributed in the hope that it will be us </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
